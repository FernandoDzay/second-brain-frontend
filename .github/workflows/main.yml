name: Deployment

# Controls when the action will run.
on:
    # Triggers the workflow on push or pull request events but only for the master branch
    push:
        branches: [main]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
    # This workflow contains a single job called "build"
    build:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest

        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            - name: Deploy using ssh
              uses: appleboy/ssh-action@master
              with:
                  host: ${{ secrets.HOST }}
                  username: ${{ secrets.USERNAME }}
                  key: ${{ secrets.PRIVATE_KEY }}
                  port: 22
                  script: |
                      cd /var/www/second-brain/frontend
                      sudo git pull
                      docker container stop second-brain-frontend
                      docker container rm second-brain-frontend
                      docker pull fernandodzay/second-brain-frontend
                      docker run -d --name second-brain-frontend -p 3014:80 fernandodzay/second-brain-frontend
